<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/pasteleriamilsabores/viewmodel/UserViewModel.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/pasteleriamilsabores/viewmodel/UserViewModel.kt" />
              <option name="originalContent" value="package com.example.pasteleriamilsabores.viewmodel&#10;&#10;import android.app.Application&#10;import android.util.Patterns&#10;import androidx.lifecycle.AndroidViewModel&#10;import androidx.lifecycle.viewModelScope&#10;import com.example.pasteleriamilsabores.data.local.UserEntity&#10;import com.example.pasteleriamilsabores.data.repository.UserRepository&#10;import kotlinx.coroutines.flow.MutableStateFlow&#10;import kotlinx.coroutines.flow.StateFlow&#10;import kotlinx.coroutines.launch&#10;&#10;sealed class RegisterResult {&#10;    object Success : RegisterResult()&#10;    object AlreadyExists : RegisterResult()&#10;    data class Error(val message: String) : RegisterResult()&#10;}&#10;&#10;class UserViewModel(application: Application) : AndroidViewModel(application) {&#10;&#10;    private val repository = UserRepository(application)&#10;&#10;    private val _registerResult = MutableStateFlow&lt;RegisterResult?&gt;(null)&#10;    val registerResult: StateFlow&lt;RegisterResult?&gt; = _registerResult&#10;&#10;    fun clearRegisterResult() {&#10;        _registerResult.value = null&#10;    }&#10;&#10;    fun registerUser(&#10;        nombre: String,&#10;        email: String,&#10;        password: String,&#10;        confirmPassword: String,&#10;        fechaNacimiento: String,&#10;        direccion: String,&#10;        rut: String,&#10;        telefono: String&#10;    ) {&#10;        // Validaciones del lado del ViewModel&#10;        if (nombre.isBlank() || email.isBlank() || password.isBlank() || confirmPassword.isBlank() || rut.isBlank()) {&#10;            _registerResult.value = RegisterResult.Error(&quot;Por favor completa todos los campos obligatorios&quot;)&#10;            return&#10;        }&#10;&#10;        // nombre completo: al menos 2 palabras&#10;        val nameParts = nombre.trim().split(&quot;\\s+&quot;)&#10;        if (nameParts.size &lt; 2 || nameParts.any { it.length &lt; 2 }) {&#10;            _registerResult.value = RegisterResult.Error(&quot;Ingresa nombre y apellido válidos&quot;)&#10;            return&#10;        }&#10;&#10;        if (!Patterns.EMAIL_ADDRESS.matcher(email).matches() || !email.contains(&quot;@&quot;)) {&#10;            _registerResult.value = RegisterResult.Error(&quot;Correo no válido&quot;)&#10;            return&#10;        }&#10;&#10;        if (password.length &lt; 6) {&#10;            _registerResult.value = RegisterResult.Error(&quot;La contraseña debe tener al menos 6 caracteres&quot;)&#10;            return&#10;        }&#10;&#10;        if (password != confirmPassword) {&#10;            _registerResult.value = RegisterResult.Error(&quot;Las contraseñas deben coincidir&quot;)&#10;            return&#10;        }&#10;&#10;        // RUT: exactamente 9 dígitos&#10;        if (!rut.matches(Regex(&quot;^\\d{9}$&quot;))) {&#10;            _registerResult.value = RegisterResult.Error(&quot;RUT inválido: debe contener 9 dígitos sin puntos ni guion&quot;)&#10;            return&#10;        }&#10;&#10;        // Teléfono opcional: si se entrega, validar que sean dígitos y longitud razonable&#10;        if (telefono.isNotBlank() &amp;&amp; !telefono.matches(Regex(&quot;^\\d{6,15}$&quot;))) {&#10;            _registerResult.value = RegisterResult.Error(&quot;Teléfono inválido&quot;)&#10;            return&#10;        }&#10;&#10;        // Si valida, guardar en Room (suspend en coroutine)&#10;        viewModelScope.launch {&#10;            val user = UserEntity(&#10;                nombre = nombre,&#10;                email = email,&#10;                password = password,&#10;                fechaNacimiento = fechaNacimiento,&#10;                direccion = direccion,&#10;                telefono = telefono,&#10;                rut = rut&#10;            )&#10;&#10;            val id = repository.register(user)&#10;            if (id == -1L) {&#10;                _registerResult.value = RegisterResult.AlreadyExists&#10;            } else {&#10;                _registerResult.value = RegisterResult.Success&#10;            }&#10;        }&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.pasteleriamilsabores.viewmodel&#10;&#10;import android.app.Application&#10;import android.util.Patterns&#10;import androidx.lifecycle.AndroidViewModel&#10;import androidx.lifecycle.viewModelScope&#10;import com.example.pasteleriamilsabores.data.local.UserEntity&#10;import com.example.pasteleriamilsabores.data.repository.UserRepository&#10;import kotlinx.coroutines.flow.MutableStateFlow&#10;import kotlinx.coroutines.flow.StateFlow&#10;import kotlinx.coroutines.launch&#10;&#10;sealed class RegisterResult {&#10;    object Success : RegisterResult()&#10;    object AlreadyExists : RegisterResult()&#10;    data class Error(val message: String) : RegisterResult()&#10;}&#10;&#10;class UserViewModel(application: Application) : AndroidViewModel(application) {&#10;&#10;    private val repository = UserRepository(application)&#10;&#10;    private val _registerResult = MutableStateFlow&lt;RegisterResult?&gt;(null)&#10;    val registerResult: StateFlow&lt;RegisterResult?&gt; = _registerResult&#10;&#10;    fun clearRegisterResult() {&#10;        _registerResult.value = null&#10;    }&#10;&#10;    fun registerUser(&#10;        nombre: String,&#10;        email: String,&#10;        password: String,&#10;        confirmPassword: String,&#10;        fechaNacimiento: String,&#10;        direccion: String,&#10;        rut: String,&#10;        telefono: String&#10;    ) {&#10;        // Validaciones del lado del ViewModel&#10;        if (nombre.isBlank() || email.isBlank() || password.isBlank() || confirmPassword.isBlank() || rut.isBlank()) {&#10;            _registerResult.value = RegisterResult.Error(&quot;Por favor completa todos los campos obligatorios&quot;)&#10;            return&#10;        }&#10;&#10;        // nombre completo: debe tener más de 3 caracteres&#10;        if (nombre.trim().length &lt;= 3) {&#10;            _registerResult.value = RegisterResult.Error(&quot;El nombre debe tener más de 3 caracteres&quot;)&#10;            return&#10;        }&#10;&#10;        if (!Patterns.EMAIL_ADDRESS.matcher(email).matches() || !email.contains(&quot;@&quot;)) {&#10;            _registerResult.value = RegisterResult.Error(&quot;Correo no válido&quot;)&#10;            return&#10;        }&#10;&#10;        if (password.length &lt; 6) {&#10;            _registerResult.value = RegisterResult.Error(&quot;La contraseña debe tener al menos 6 caracteres&quot;)&#10;            return&#10;        }&#10;&#10;        if (password != confirmPassword) {&#10;            _registerResult.value = RegisterResult.Error(&quot;Las contraseñas deben coincidir&quot;)&#10;            return&#10;        }&#10;&#10;        // RUT: exactamente 9 dígitos&#10;        if (!rut.matches(Regex(&quot;^\\d{9}$&quot;))) {&#10;            _registerResult.value = RegisterResult.Error(&quot;RUT inválido: debe contener 9 dígitos sin puntos ni guion&quot;)&#10;            return&#10;        }&#10;&#10;        // Teléfono opcional: si se entrega, validar que sean dígitos y longitud razonable&#10;        if (telefono.isNotBlank() &amp;&amp; !telefono.matches(Regex(&quot;^\\d{6,15}$&quot;))) {&#10;            _registerResult.value = RegisterResult.Error(&quot;Teléfono inválido&quot;)&#10;            return&#10;        }&#10;&#10;        // Si valida, guardar en Room (suspend en coroutine)&#10;        viewModelScope.launch {&#10;            val user = UserEntity(&#10;                nombre = nombre,&#10;                email = email,&#10;                password = password,&#10;                fechaNacimiento = fechaNacimiento,&#10;                direccion = direccion,&#10;                telefono = telefono,&#10;                rut = rut&#10;            )&#10;&#10;            val id = repository.register(user)&#10;            if (id == -1L) {&#10;                _registerResult.value = RegisterResult.AlreadyExists&#10;            } else {&#10;                _registerResult.value = RegisterResult.Success&#10;            }&#10;        }&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>